set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

cmake_minimum_required(VERSION 3.20)

project(WisdomEngine CXX)

find_package(doctest QUIET)
find_package(benchmark QUIET)
find_package(SQLite3 QUIET)
find_package(Microsoft.GSL QUIET)
find_package(Threads REQUIRED)

if (NOT WIN32)
    message("-- wisdom-chess: stack protector disabled for performance")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fno-stack-protector")
endif()

if (doctest_FOUND)
    message("-- wisdom-chess: Including tests with doctest")
    add_subdirectory(test)
else()
    message("-- wisdom-chess: Tests disabled (doctest not found)")
    set(WISDOM_CHESS_SLOW_TESTS Off)
    set(WISDOM_CHESS_FAST_TESTS Off)
endif()

if (WISDOM_CHESS_BENCHMARK)
    if (benchmark_FOUND)
        message("-- wisdom-chess: Benchmarking enabled")
        add_subdirectory(benchmark)
    else()
        message("-- wisdom-chess: Benchmarking disabled (Google benchmark not found)")
    endif()
else()
    message("-- wisdom-chess: Benchmarking disabled.")
endif()

if (SQLite3_DIR)
    message("-- wisdom-chess: SQLite3 not found")
    set(SQLite3_Found ON)
else()
    message("-- wisdom-chess: SQLite3 found")
    set(SQLite3_Found OFF)
endif()

if (Microsoft.GSL_DIR)
    message("-- Found Microsoft.GSL")
    set(Microsoft.GSL_Found ON)
else()
    message("-- Using bundled GSL")
    set(Microsoft.GSL_Found OFF)
endif()

add_subdirectory(src)

